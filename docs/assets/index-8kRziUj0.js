(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const a of e)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?a.credentials="include":e.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(e){if(e.ep)return;e.ep=!0;const a=n(e);fetch(e.href,a)}})();var U;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(U||(U={}));var g;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(g||(g={}));var P;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(P||(P={}));var M;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(M||(M={}));var v;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(v||(v={}));var y;(function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"})(y||(y={}));var H;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(H||(H={}));var F;(function(t){t.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",t.HTTP_IN_QUERY="HTTP_IN_QUERY",t.HTTP_IN_HEADER="HTTP_IN_HEADER",t.HTTP_IN_PATH="HTTP_IN_PATH",t.HTTP_IN_BODY="HTTP_IN_BODY",t.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(F||(F={}));var G;(function(t){t.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",t.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",t.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",t.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(G||(G={}));var B;(function(t){t.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",t.LOW="LOW",t.HIGH="HIGH"})(B||(B={}));var b;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(b||(b={}));var Y;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(Y||(Y={}));var x;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(x||(x={}));var k;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",t.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",t.NO_IMAGE="NO_IMAGE"})(k||(k={}));var V;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(V||(V={}));var K;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(K||(K={}));var J;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",t.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",t.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(J||(J={}));var j;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY",t.MODEL_ARMOR="MODEL_ARMOR",t.JAILBREAK="JAILBREAK"})(j||(j={}));var W;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(W||(W={}));var X;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(X||(X={}));var $;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})($||($={}));var Z;(function(t){t.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",t.TUNING_MODE_FULL="TUNING_MODE_FULL",t.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(Z||(Z={}));var q;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(q||(q={}));var z;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(z||(z={}));var Q;(function(t){t.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",t.TUNING_TASK_I2V="TUNING_TASK_I2V",t.TUNING_TASK_T2V="TUNING_TASK_T2V",t.TUNING_TASK_R2V="TUNING_TASK_R2V"})(Q||(Q={}));var tt;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(tt||(tt={}));var et;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(et||(et={}));var nt;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(nt||(nt={}));var ot;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(ot||(ot={}));var st;(function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(st||(st={}));var at;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE",t.VALIDATED="VALIDATED"})(at||(at={}));var it;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(it||(it={}));var ct;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(ct||(ct={}));var rt;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"})(rt||(rt={}));var Et;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Et||(Et={}));var dt;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(dt||(dt={}));var lt;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(lt||(lt={}));var _t;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(_t||(_t={}));var It;(function(t){t.FOREGROUND="FOREGROUND",t.BACKGROUND="BACKGROUND",t.PROMPT="PROMPT",t.SEMANTIC="SEMANTIC",t.INTERACTIVE="INTERACTIVE"})(It||(It={}));var Tt;(function(t){t.ASSET="ASSET",t.STYLE="STYLE"})(Tt||(Tt={}));var ut;(function(t){t.INSERT="INSERT",t.REMOVE="REMOVE",t.REMOVE_STATIC="REMOVE_STATIC",t.OUTPAINT="OUTPAINT"})(ut||(ut={}));var At;(function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"})(At||(At={}));var Ot;(function(t){t.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",t.PREFERENCE_TUNING="PREFERENCE_TUNING"})(Ot||(Ot={}));var Nt;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.STATE_PENDING="STATE_PENDING",t.STATE_ACTIVE="STATE_ACTIVE",t.STATE_FAILED="STATE_FAILED"})(Nt||(Nt={}));var pt;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})(pt||(pt={}));var St;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED"})(St||(St={}));var ft;(function(t){t.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.RESPONSE_REJECTED="RESPONSE_REJECTED",t.NEED_MORE_INPUT="NEED_MORE_INPUT"})(ft||(ft={}));var mt;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(mt||(mt={}));var Ct;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Ct||(Ct={}));var ht;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(ht||(ht={}));var Dt;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(Dt||(Dt={}));var Lt;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Lt||(Lt={}));var Rt;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Rt||(Rt={}));var wt;(function(t){t.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",t.QUALITY="QUALITY",t.DIVERSITY="DIVERSITY",t.VOCALIZATION="VOCALIZATION"})(wt||(wt={}));var Ut;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(Ut||(Ut={}));var gt;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents",t.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",t.PAGED_ITEM_DOCUMENTS="documents"})(gt||(gt={}));function yt(t=null){const o=document.createElement("div");o.classList.add("tab-container");const n=document.createElement("div");n.classList.add("tab-buttons");const s=document.createElement("div");s.classList.add("tab-contents"),o.appendChild(n),o.appendChild(s);const e=[];function a(i){e.forEach(c=>{c.button.classList.toggle("active",c.id===i),c.content.style.display=c.id===i?"block":"none",c.id===i&&c.onShown()})}return o.addTab=function({title:i,content:c}){const r="tab-"+(e.length+1),E=document.createElement("button");E.classList.add("tab-button"),E.textContent=i,E.addEventListener("click",()=>a(r));const _=document.createElement("div");_.classList.add("tab-content"),typeof c=="string"?_.innerHTML=c:c instanceof HTMLElement&&_.appendChild(c),n.appendChild(E),s.appendChild(_),e.push({id:r,button:E,content:_,onShown:async function(){const d=I=>{for(const l of I.children)typeof l.onShown=="function"&&l.onShown(),d(l)};d(_)}}),e.length===1&&a(r)},t&&t.appendChild(o),o}function bt(t=null){const o=document.createElement("div");o.id="ShotPreviewsContainer";const n=document.createElement("div");n.classList.add("contents-wrapper"),o.appendChild(n);const s=document.createElement("div");s.classList.add("resizer"),o.appendChild(s);let e=!1;s.addEventListener("mousedown",()=>{e=!0,document.body.style.userSelect="none"}),document.addEventListener("mousemove",i=>{if(!e)return;const c=i.clientY-o.getBoundingClientRect().top;c>50&&(o.style.height=c+"px")}),document.addEventListener("mouseup",()=>{e=!1,document.body.style.userSelect="auto"});function a(i){n.appendChild(i)}return t&&t.appendChild(o),{appendChild:a,container:o}}function Yt(t=null){const o=document.createElement("div");return o.classList.add("horizontal-container"),t&&t.appendChild(o),o}function h(t,o=null){const n=document.createElement("div");n.classList.add("collapsible-container");const s=document.createElement("div");s.classList.add("collapsible-header");const e=document.createElement("span");e.textContent=t,e.classList.add("collapsible-label");const a=document.createElement("button");a.textContent="Collapse",a.classList.add("collapsible-button"),s.appendChild(e),s.appendChild(a);const i=document.createElement("div");i.classList.add("collapsible-content"),i.style.marginTop="10px";let c=!1;return a.addEventListener("click",()=>{c=!c,i.style.display=c?"none":"block",a.textContent=c?"Expand":"Collapse"}),n.appendChild(s),n.appendChild(i),n.appendChild=function(r){i.appendChild(r)},o&&o.appendChild(n),n}function N(t=null){const o=document.createElement("div");return o.classList.add("buttons-container"),t&&t.appendChild(o),o}function xt(t){const o=[...t.children];o.sort((n,s)=>n.id.localeCompare(s.id)),o.forEach(n=>t.appendChild(n))}async function f(t,o,n={}){const s=await t.getFileHandle(o,{create:!0}),a=await(await s.getFile()).text()||"{}";let i=JSON.parse(a);return i={...n,...i},i.____handle=s,i.save=async function(){kt(this)},i}async function kt(t){try{const o=JSON.stringify(t,null,2),s=await t.____handle.createWritable();await s.write(o),await s.close(),console.log("Saved bound json")}catch(o){console.error("Failed to save",o)}}function m(){return new Promise((t,o)=>{const n=indexedDB.open("folderDB",1);n.onupgradeneeded=s=>{const e=s.target.result;e.objectStoreNames.contains("folders")||e.createObjectStore("folders")},n.onsuccess=()=>t(n.result),n.onerror=()=>o(n.error)})}async function Vt(t){const n=(await m()).transaction("folders","readwrite"),s=n.objectStore("folders");s.put(t,"lastFolder");const e=s.get("recentFolders");e.onsuccess=a=>{let i=a.target.result||[];i.includes(t)||(i.unshift(t),i.length>10&&(i=i.slice(0,10)),s.put(i,"recentFolders"))},await n.complete}async function Kt(){const n=(await m()).transaction("folders","readonly").objectStore("folders");return new Promise(s=>{const e=n.get("lastFolder");e.onsuccess=()=>s(e.result),e.onerror=()=>s(null)})}async function Jt(){const n=(await m()).transaction("folders","readonly").objectStore("folders");return new Promise(s=>{const e=n.get("recentFolders");e.onsuccess=()=>s(e.result||[]),e.onerror=()=>s([])})}async function jt(){const t=await m(),n=t.transaction("folders","readonly").objectStore("folders"),s=await new Promise(e=>{const a=n.get("user_settings");a.onsuccess=()=>e(a.result||{}),a.onerror=()=>e({})});return s.save=async function(){const{save:e,...a}=this,i=t.transaction("folders","readwrite");i.objectStore("folders").put(a,"user_settings"),await new Promise((r,E)=>{i.oncomplete=()=>r(),i.onerror=()=>E(i.error),i.onabort=()=>E(i.error)})},s}const p={};p.getDB=m;p.savePickedFolder=Vt;p.loadPickedFolder=Kt;p.loadRecentFolders=Jt;p.loadUserData=jt;window.db=p;async function O(t,o,n=null){const s=await h(o,n),e=await Wt(t[o],1,s,async a=>{t[o]=a,t.save()});return s.setText=async function(a){e.value=a,e.autoResize(),t[o]=a,saveBoundJson(t)},s.onShown=function(){e.onShown()},n&&n.appendChild(s),s}async function Wt(t="",o=1,n=null,s=null){const e=document.createElement("textarea");e.id="prompt-area",e.placeholder="Enter your prompt here...",e.rows=o,e.value=t;const a=()=>{e.style.height="auto",e.style.height=Math.max(e.scrollHeight,o*16)+"px"};e.addEventListener("input",a),e.autoResize=a,e.onShown=a;let i;return e.addEventListener("input",()=>{a(),clearTimeout(i),i=setTimeout(async()=>{s?.(e.value)},500)}),requestAnimationFrame(a),n&&n.appendChild(e),e}async function D(t,o,n=null){console.log(t);const s=document.createElement("div");s.className="editable-field";const e=document.createElement("label");e.textContent=o;const a=document.createElement("input");a.type="text",a.placeholder="Enter your {$key}} ...",a.value=t[o]||"";let i;return a.addEventListener("input",()=>{clearTimeout(i),i=setTimeout(async()=>{t[o]=a.value,t?.save()},300)}),s.appendChild(e),s.appendChild(a),n&&n.appendChild(s),s}async function Ht(t=null,o=500){const n=document.createElement("div");n.style.height=`${o}px`,t&&t.appendChild(n)}function Xt(t,o,n,s=null){const e=document.createElement("div");e.className="editable-field";let a;a=document.createElement("label"),a.textContent=t,e.appendChild(a);const i=document.createElement("select");return o.forEach(c=>{const r=document.createElement("option");r.value=c.toLowerCase().replace(/\s+/g,"-"),r.text=c,i.appendChild(r)}),typeof s=="function"&&i.addEventListener("change",c=>{s(c.target.value)}),e.setValue=function(c){const r=c.toLowerCase().replace(/\s+/g,"-");i.value=r},e.appendChild(i),n&&n.appendChild(e),e}function T(t,o,n=null,s=null){const e=document.createElement("button");return e.id=t,e.textContent=o,n&&n.appendChild(e),s&&e.addEventListener("click",s),e}async function Ft(){window.artbook=[],window.artbookDirHandle=await window.rootDirHandle.getDirectoryHandle("REFS",{create:!0});for await(const[t,o]of window.artbookDirHandle.entries())if(o.kind==="directory"){let n=await $t(t,o);window.artbook.push(n)}}async function $t(t,o){const n={name:t,handle:o,items:[],path:t,async loadItems(){this.items=[];for await(const[s,e]of this.handle.entries())e.kind==="directory"&&this.items.push(await Zt(s,e,this))}};return await n.loadItems(),n}async function Zt(t,o,n){const s={name:t,handle:o,images:[],path:n.path+"/"+t,async loadImages(){for await(const[e,a]of this.handle.entries())a.kind==="file"&&(e.toLowerCase().endsWith(".json")||this.images.push({name:e,handle:a,category:n,subCategory:this,path:this.path+"/"+e,data:await f(this.handle,e+".json"),async createTagItem(i=null,c=null){const r=document.createElement("div");r.className="tag-item",r.style.display="flex",r.style.alignItems="center",r.style.gap="8px",r.style.padding="4px 6px",r.style.border="1px solid #888",r.style.borderRadius="6px",r.style.background="#222",r.style.color="#fff",r.style.marginBottom="4px";const E=document.createElement("img");E.className="tag-item-thumb",E.style.width="32px",E.style.height="32px",E.style.objectFit="cover",E.style.borderRadius="4px";const _=await this.handle.getFile();E.src=URL.createObjectURL(_);const d=document.createElement("span");d.textContent=`${this.path}`,d.style.flex="1",d.style.overflow="hidden",d.style.textOverflow="ellipsis",d.style.whiteSpace="nowrap";const I=document.createElement("button");return I.textContent="×",I.style.background="#900",I.style.border="none",I.style.color="#fff",I.style.cursor="pointer",I.style.fontWeight="bold",I.style.borderRadius="4px",I.style.padding="0 6px",c&&typeof c=="function"&&I.addEventListener("click",l=>{l.stopPropagation(),c(r,this)}),r.append(E,d,I),i&&i.appendChild(r),r},async createImagePanel(i=null){const c=document.createElement("div");c.className="image-panel",c.style.display="none",c.style.flexDirection="column";const r=document.createElement("div");r.textContent=this.name,r.style.fontSize="18px",r.style.fontWeight="bold",r.style.marginBottom="12px",c.appendChild(r);const E=document.createElement("img"),_=await this.handle.getFile();E.src=URL.createObjectURL(_),E.style.maxWidth="90%",E.style.maxHeight="90%",c.appendChild(E);const d=N(c),I=await O(this.data,"prompt",c);return T("img_log_btn","LOG",d).addEventListener("click",async()=>{console.log("LOG:",this)}),T("gpt-describe-btn","GPT Describe",d).addEventListener("click",async()=>{console.log("LOG:",this),base_text=`${window.projinfo.describe_prompt}`,console.log(base_text);const A=await GPT.txt2txt(base_text,void 0,[this]);I.setText(A)}),T("gpt-describe-env-btn","GPT ENV Describe",d,async()=>{console.log("LOG:",this),base_text=`${window.projinfo.describe_env_prompt}`,console.log(base_text);const A=await GPT.txt2txt(base_text,void 0,[this]);I.setText(A)}),i&&i.appendChild(c),c}}))}};return await s.loadImages(),s}const R={async createArtbookPanel(t=null){const o=document.createElement("div"),n=yt(o);await Ft();for(const s of window.artbook){const e=document.createElement("div");e.className="art-type-container";for(const a of s.items){const i=document.createElement("div");i.className="art-item-container";const c=document.createElement("div");c.className="art-item-title",c.textContent=a.name;const r=document.createElement("div");r.className="art-images-container";const E=document.createElement("div");E.className="art-image-panels-container";for(const _ of a.images){const d=await _.handle.getFile(),I=URL.createObjectURL(d),l=_.name;if(/\.(png|jpe?g|gif|webp)$/i.test(l)){const u=document.createElement("div");u.className="img-wrapper";const A=document.createElement("img");A.src=I,A.className="media-img",A.title=l;const S=document.createElement("div");S.className="img-label",S.textContent=l,u.appendChild(A),u.appendChild(S),r.appendChild(u);const Gt=await _.createImagePanel(E);A.addEventListener("click",()=>{document.querySelectorAll(".image-panel").forEach(Bt=>Bt.style.display="none"),Gt.style.display="flex"})}}i.append(c,r,E),e.appendChild(i)}n.addTab({title:s.name,content:e})}console.log(window.artbook),t&&t.appendChild(o)},async createAddTagButton(t=null,o=null){const n=document.createElement("div");n.className="add-tag-wrapper";const s=document.createElement("div");s.className="add-tag-button",s.textContent="Add Tag";const e=document.createElement("div");e.className="tag-dropdown";for(const a of window.artbook){const i=document.createElement("div");i.className="dropdown-item",i.textContent=a.name;const c=document.createElement("div");c.className="sub-dropdown";for(const r of a.items){const E=document.createElement("div");E.className="dropdown-item",E.textContent=r.name;const _=document.createElement("div");_.className="sub-dropdown";for(const d of r.images){const I=document.createElement("div");I.className="image-dropdown-item";const l=document.createElement("span");l.textContent=d.name;const u=document.createElement("img");u.className="tag-img-thumb";const A=await d.handle.getFile();u.src=URL.createObjectURL(A),o&&typeof o=="function"&&I.addEventListener("click",S=>{S.stopPropagation(),o(d)}),I.appendChild(u),I.appendChild(l),_.appendChild(I)}E.appendChild(_),c.appendChild(E)}i.appendChild(c),e.appendChild(i)}n.append(s,e),t&&t.appendChild(n)},async path2img(t){for(const o of window.artbook)for(const n of o.items)for(const s of n.images)if(s.path===t)return s;return null}};async function qt(t,o=null){const n=h("tasks",o);return n.addTask=function(s){const e=document.createElement("div");e.className="kie-task",e.style.display="flex",e.style.alignItems="center",e.style.gap="8px";const a=document.createElement("div");a.style.flex="1",a.textContent=`${s.createdAt}`,e.appendChild(a);const i=document.createElement("div");i.style.minWidth="180px",i.textContent="Idle",i.style.color="#888",i.style.fontSize="12px",e.appendChild(i);const c=document.createElement("div");c.style.width="12px",c.style.height="12px",c.style.borderRadius="50%",c.style.backgroundColor=s.status=="downloaded"?"#44ff44":"#ff4444",c.title="Not downloaded",e.appendChild(c);const r=document.createElement("button");r.textContent="Check Results",r.addEventListener("click",async()=>{try{await s.checkResults()}catch(_){console.error("Task check failed",_)}}),e.appendChild(r),e.update=async function(){c.style.backgroundColor=s.status==C.finished?"#44ff44":"#ff4444",i.textContent=s.status},e.update(),s.addUpdateCallback(_=>{e.update()});const E=document.createElement("button");E.textContent="LOG",E.addEventListener("click",async()=>{console.log("TASK: ",s),console.log("SHOT: ",s.getShot())}),e.appendChild(E),n.appendChild(e)},n.init=function(){for(const s of t.taskinfo.tasks)n.addTask(s)},n.init(),n}const C={checking:"checking",downloading:"downloading",finished:"finished"};function Pt(t){return{resultUrls:[],status:"idle",getShot(){return t},fromTask(n){return Object.assign(this,n),this},async saveResults(){const n=this,s=n.getShot();console.log("Saving result images:",n.resultUrls);const e=await s.handle.getDirectoryHandle(n.outputFolder,{create:!0});if(n.resultUrls==null){console.log("RESULT URLS IS EMPTY");return}this.setStatus(C.downloading);for(const a of n.resultUrls)await downloadURL(a,e);n.setStatus(C.finished),n.finished=!0,await s.taskinfo.save(),await s.updateEvent()},async checkResults(n=5e3,s=100){this.setStatus(C.checking);let e=0;for(;e<s;){if(await checkTaskResults(this),this.resultUrls.length>0){await this.saveResults();break}await new Promise(a=>setTimeout(a,n)),e++,console.log(`Waiting for results... attempt ${e}`)}},async setStatus(n){this.status=n,this.updateEvent()},async updateEvent(){const n=new CustomEvent("taskupdate",{detail:{task:this}});document.dispatchEvent(n)},async addUpdateCallback(n){document.addEventListener("taskupdate",s=>{s.detail.task.taskId==this.taskId&&n(s.detail)})}}}async function zt(t){if(window.currentFolderHandle=t.handle,document.querySelectorAll("#folders li").forEach(l=>l.classList.remove("selected")),window.contentsPanel.innerHTML="",t.ui_scenepanel){window.contentsPanel.appendChild(t.ui_scenepanel);return}const o=new CustomEvent("selectscene",{detail:{}});document.dispatchEvent(o);const n=await ee(t),s=document.createElement("div"),e=document.createElement("div");e.textContent=t.name,e.classList.add("shot-info-title"),s.appendChild(e);const a=N(s);T("log-scene","LOG",a,async()=>{console.log("SCENE:",t)}),T("delete-scene-btn","DELETE",a,async()=>{t.delete()}),T("explore-scene-btn","OPEN",a,async()=>{try{const u=await(await fetch("http://127.0.0.1:5000/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:["explorer",`.\\SCENES\\${t.name}`]})})).json();console.log(u)}catch(l){console.log(l)}}),await O(t.sceneinfo,"script",s);const i=N(parent=s),c=await O(t.sceneinfo,"shotsjson",s);T("generate-split-into-shots-prompt-btn","Generate Split Prompt",i).addEventListener("click",async()=>{const l=await t.getTagsString();base_text=`${window.projinfo.split_shot_prompt} 
      
      ${l} 

      ${t.sceneinfo.script}
      `,navigator.clipboard.writeText(base_text),console.log(`GENERATED PROMPT:
`,base_text)}),T("generate-split-into-shots-prompt-refs-btn","Generate Split Prompt(with REFS)",i).addEventListener("click",async()=>{const l=await t.getTagsString();base_text=`${window.projinfo.split_shot_prompt} 
    
    ${l}

    ${t.sceneinfo.script}
    `,console.log("GENERATED PROMPT:",base_text);const A=await GPT.txt2txt(base_text,"You are a helpful assistant. Always respond using ONLY valid JSON. Do not write explanations. Do not wrap the JSON in backticks. The entire response must be a valid JSON object.");c.setText(A)}),T("generate-shots-from-json-btn","Generate Shots from JSON",i).addEventListener("click",async()=>{shotdict=JSON.parse(t.sceneinfo.shotsjson);for(const l in shotdict)await t.createShot(l,shotdict[l])});const d=await Qt(t,s);await R.createAddTagButton(i,l=>{console.log(l),d.addTag(l),t.addTag(l)}),T("log-tags-btn","LOG TAGS",i,async()=>{console.log(`SCENE TAGS:
`,await t.getTagsString())}),T("copy-prompts-btn","MJ Prompts",i,async()=>{let l="";for(shot of t.shots)l+=shot.shotinfo.prompt+`
----
`;console.log(l),await navigator.clipboard.writeText(l)}),T("copy-prompts-tags-btn","MJ+TAGS",i,async()=>{const l=await t.getTagsString();let u="";for(shot of t.shots)u+=shot.shotinfo.prompt+`
`+l+`
----
`;console.log(u),await navigator.clipboard.writeText(u)}),Ht(s);const I=yt(window.contentsPanel);return I.addTab({title:"Scene",content:s}),I.addTab({title:"Shots",content:n}),t.ui_scenepanel=I,I}async function Qt(t,o=null){const n=h("Tags",o);n.addTag=async function(s){s.createTagItem(n,(e,a)=>{console.log(e,a),e.remove(),t.removeTag(a)})};for(const s of t.sceneinfo.tags){const e=await R.path2img(s);e&&n.addTag(e)}return n}async function te(t,o=null){const n=document.createElement("div");n.classList.add("shot-info");const s=document.createElement("div");s.textContent=t.name,s.classList.add("shot-info-title"),n.appendChild(s);const e=N(n);return T("rename-shot-btn","RENAME",e,()=>{const a=prompt("Rename the shot:",t.name);a&&t.renameShot(a)}),T("delete-shot-btn","DELETE",e,()=>{confirm("Are you sure you want to delete this shot?")&&t.deleteFromDisk()}),await O(t.shotinfo,"prompt",n),await O(t.shotinfo,"camera",n),await O(t.shotinfo,"action_description",n),oe(t,n),n.taskContainer=await qt(t,n),await Mt(t,"results",n),await Mt(t,"resultVods",n),o&&o.appendChild(n),n}async function ee(t){const o=document.createElement("div");return o.scene=t,o.shots=[],o.initialize=async function(){const n=this,s=bt(parent=this);this.shotsStrip=Yt(s),T("add-shot","+",this.shotsStrip,async()=>{const e=prompt("SHOT NAME:","SHOT_010");e&&await n.scene.createShot(e)}),this.shotInfoContainer=document.createElement("div"),this.shotInfoContainer.classList.add("shot-info-container"),this.appendChild(this.shotInfoContainer),Ht(this)},o.addShot=async function(n){const s=await ne(n);this.shotsStrip.appendChild(s);const e=await te(n,parent=this.shotInfoContainer);e.style.display="none",s.addEventListener("click",()=>{document.querySelectorAll(".shot-info").forEach(a=>a.style.display="none"),e.style.display="block"}),o.shots.push({shot:n,shotElement:s,shot_info:e}),o.orderShots()},o.addSceneShots=async function(){for(const n of this.scene.shots)this.addShot(n)},o.orderShots=function(){this.shots.sort((n,s)=>n.shot.name.localeCompare(s.shot.name)),this.shots.forEach(n=>{this.shotsStrip.appendChild(n.shotElement)})},o.onShotCreate=n=>{if(o.isConnected==!1){document.removeEventListener("shot_create",o.onShotCreate);return}n.detail.shot,t==o.scene&&o.addShot(n.detail.shot)},document.addEventListener("shot_create",o.onShotCreate),o.onShotRemove=n=>{if(o.isConnected==!1){document.removeEventListener("shot_remove",o.onShotRemove);return}const s=n.detail.shot;if(t==o.scene){const e=o.shots.findIndex(a=>a.shot===s);if(e!==-1){const a=o.shots[e];a.shotElement.remove(),a.shot_info.remove(),o.shots.splice(e,1)}}},document.addEventListener("shot_remove",o.onShotRemove),await o.initialize(),await o.addSceneShots(),o}async function ne(t){const o=document.createElement("div");o.classList.add("shot-preview");const n=document.createElement("img");o.update=async function(){if(n.src="https://picsum.photos/id/237/200/300",t.shotinfo.srcImage){const i=await(await(await t.handle.getDirectoryHandle("results",{create:!1})).getFileHandle(t.shotinfo.srcImage,{create:!1})).getFile(),c=URL.createObjectURL(i);n.src=c}},o.update(),o.appendChild(n);const s=document.createElement("div");return s.textContent=t.name,s.classList.add("shot-preview-label"),o.appendChild(s),document.addEventListener("shotupdate",e=>{e.detail.shot==t&&o.update()}),o}async function oe(t,o=null){const n=N(o);return T("testBtn","Log shot",n).addEventListener("click",async()=>{console.log(t)}),T("testBtn","Update",n).addEventListener("click",async()=>{t.updateEvent()}),await se(t,n),T("create-resolve-xml-btn","Generate Resolve FCPXML",n).addEventListener("click",async()=>{const E=await window.currentFolderHandle.getDirectoryHandle("results",{create:!1});await generateFCPXMLFromFolder(E)}),T("txt2imgBtn","txt2img",n).addEventListener("click",async()=>{console.log("Clicked txt2img:",t);try{const E=await kieGenerate_txt2img(t.shotinfo.prompt),_=await t.addKieTask(E);o?.taskContainer?.addTask(_)}catch(E){console.error(E)}}),T("img2videoBtn","img2video",n).addEventListener("click",async()=>{console.log("Clicked img2video:",t);try{const E=await t.getSrcImageHandle();if(console.log("SRC_IMAGE",E),E&&(img_upload_data=await kieUploadFile(E),console.log("Image upload data:",img_upload_data.downloadUrl),img_upload_data&&img_upload_data.success)){const _=await kieGenerate_RunwayImg2Video(t.shotinfo.prompt,img_upload_data.downloadUrl),d=await t.addKieTask(_);o?.taskContainer?.addTask(d)}}catch(E){console.error(E)}}),T("url2imgBtn","importURL",n).addEventListener("click",async()=>{try{const E=await navigator.clipboard.readText();if(!E)return;let _;try{_=new URL(E).href}catch{return}const d=await t.handle.getDirectoryHandle("results",{create:!0});await downloadURL(_,d),console.log("Download completed!"),await t.updateEvent()}catch{}}),n}async function se(t,o=null){const n=T("shot-toggle-btn","Finished",o);function s(e){e.style.backgroundColor=t.shotinfo.finished?"lightgreen":"lightgrey"}return s(n),n.addEventListener("click",()=>{t.setStatus(!t.shotinfo.finished),s(n)}),n}async function Mt(t,o,n=null){const s=await h(o,n),e=document.createElement("div");e.className="media-container";async function a(){let i=null;try{i=await t.handle.getDirectoryHandle(o,{create:!1})}catch{return}e.innerHTML="";for await(const[c,r]of i.entries()){if(r.kind!=="file")continue;const E=await r.getFile(),_=URL.createObjectURL(E);if(/\.(png|jpe?g|gif|webp)$/i.test(c)){const d=document.createElement("div");d.className="img-wrapper",c===t.shotinfo.srcImage&&d.classList.add("highlighted");const I=document.createElement("img");I.src=_,I.className="media-img",I.title=c;const l=document.createElement("button");l.className="media-hover-btn",l.textContent="Pick",l.addEventListener("click",u=>{u.stopPropagation(),t.shotinfo.srcImage=c,t.saveShotInfo(),t.updateEvent(),e.querySelectorAll(".img-wrapper.highlighted").forEach(A=>A.classList.remove("highlighted")),d.classList.add("highlighted")}),d.append(I,l),e.appendChild(d)}if(/\.(mp4|webm|ogg|mov|mkv)$/i.test(c)){const d=document.createElement("video");d.src=_,d.style.width="auto",d.style.maxHeight="300px",d.style.objectFit="contain",d.title=c,d.autoplay=!0,d.muted=!0,d.loop=!0,d.controls=!0,e.appendChild(d)}}}return s.update=async()=>{await a()},t.addUpdateCallback(i=>{console.log("UPDATE Media Container",s),console.log(t,i),s.update()}),await a(),s.appendChild(e),s}async function L(t,o,n){let e=await f(o,"shotinfo.json",{finished:!1}),a=await f(o,"tasks.json",{tasks:[]});const i={name:t,handle:o,shotinfo:e,taskinfo:a,scene:n,async saveShotInfo(){await saveBoundJson(this.shotinfo)},async saveTaskInfo(){await saveBoundJson(this.taskinfo)},async addKieTask(c){const r=Pt(this).fromTask(c);return this.taskinfo.tasks.push(r),this.taskinfo.save(),r.checkResults(),r},initializeTasks(){const c=this,r=[];for(const E of this.taskinfo.tasks)r.push({...Pt(c),...E});this.taskinfo.tasks=r},async getSrcImageHandle(){try{return this.shotinfo.srcImage==null?null:await(await this.handle.getDirectoryHandle("results",{create:!1})).getFileHandle(this.shotinfo.srcImage,{create:!1})}catch{}return null},async updateEvent(c=null){await this.onUpdateEvent();const r=new CustomEvent("shotupdate",{detail:{shot:this,action:c}});document.dispatchEvent(r)},async addUpdateCallback(c){console.log("ADDED SHOT UPDATE LISTENER",c),document.addEventListener("shotupdate",r=>{r.detail.shot==this&&c(r.detail)})},async onDelete(c){const r=E=>{E.detail.shot===this&&E.detail.action==="delete"&&c(E.detail.shot)};return document.addEventListener("shotupdate",r),r},async onUpdateEvent(){if(!this.shotinfo.srcImage)try{dirHandle=await this.handle.getDirectoryHandle("results",{create:!1});for await(const[c,r]of dirHandle.entries())if(r.kind==="file"&&/\.(png|jpe?g|gif|webp)$/i.test(c)){this.shotinfo.srcImage=c,await i.saveShotInfo();return}}catch{}},async deleteFromDisk(){try{const c=this.scene.shots.indexOf(this);c>-1&&this.scene.shots.splice(c,1),this.handle&&await this.scene.handle.removeEntry(this.name,{recursive:!0}),document.dispatchEvent(new CustomEvent("shot_remove",{detail:{shot:this}}))}catch(c){console.error(`Failed to delete shot "${this.name}":`,c)}},async renameShot(c){console.log("RENAME ",this," to name ",c),await copyDirectory(this.scene.handle,this.name,c);const r=await L(c,o,this.scene);document.dispatchEvent(new CustomEvent("shot_create",{detail:{shot:r}}));let E=this.scene.shots.findIndex(_=>_.name.localeCompare(c)>0);E===-1&&(E=this.scene.shots.length),this.scene.shots.splice(E,0,r),await this.deleteFromDisk()},async setStatus(c){c!=this.shotinfo.finished&&(this.shotinfo.finished=c,this.scene.ui_treeitem.update(),this.shotinfo.save())}};return i.initializeTasks(),i}async function ae(t,o){let s=await f(o,"sceneinfo.json",{finished:!1,description:"",location:"",shotsjson:"",script:"",tags:[],ui_treeitem:null,ui_scenepanel:null});const e={name:t,handle:o,shots:[],sceneinfo:s,async LoadShots(){this.shots=[];for await(const[a,i]of this.handle.entries())i.kind==="directory"&&this.shots.push(await L(a,i,this))},async addTag(a){this?.sceneinfo?.tags?.includes(a.path)||this.sceneinfo.tags.push(a.path),console.log("Scene",this),this.sceneinfo.save()},async removeTag(a){if(!this?.sceneinfo?.tags)return;const i=this.sceneinfo.tags.indexOf(a.path);i!==-1&&(this.sceneinfo.tags.splice(i,1),console.log("Removed tag:",a.path,"Scene:",this),this.sceneinfo.save())},async getTags(){const a=[];for(const i of this.sceneinfo.tags)a.push(await artbookUI.path2img(i));return a},async getTagsString(){const a={};for(const i of await e.getTags()){if(i==null)continue;const c=i.category.name,r=i.subCategory.name,E=i.data?.prompt||"";a[c]||(a[c]={}),a[c][r]=E}return JSON.stringify(a,null,2)},async createShot(a,i=null){console.log("Generating shot:",a),console.log("Shot data:",i);const c=await this.handle.getDirectoryHandle(a,{create:!0}),r=await L(a,c,this);let E=this.shots.findIndex(_=>_.name.localeCompare(a)>0);E===-1&&(E=this.shots.length),this.shots.splice(E,0,r),i&&(r.shotinfo={...r.shotinfo,...i},await r.shotinfo.save()),document.dispatchEvent(new CustomEvent("shot_create",{detail:{shot:r}}))},getFinishedShotCount(){return this.shots.filter(a=>a.shotinfo.finished).length},getTotalShotCount(){return this.shots.length},async delete(){if(confirm(`Are you sure you want to delete scene ${this.name}?`)){const a=window.scenes.indexOf(this);a>-1&&window.scenes.splice(a,1),this.handle&&await window.scenesDirHandle.removeEntry(this.name,{recursive:!0}),this?.ui_treeitem?.remove?.()}},async getTreeItem(){if(this.ui_treeitem)return this.ui_treeitem;this.ui_treeitem=document.createElement("li"),this.ui_treeitem.id=`treeview-scene-${e.name}`,this.ui_treeitem.classList.add("scene-li");const a=document.createElement("div");a.classList.add("scene-header"),this.ui_treeitem.appendChild(a);const i=document.createElement("span");i.textContent=e.name,a.appendChild(i);const c=document.createElement("span");return c.classList.add("scene-counter"),a.appendChild(c),a.addEventListener("click",()=>{zt(e)}),this.ui_treeitem.update=function(){c.textContent=`${e.getFinishedShotCount()}/${e.getTotalShotCount()}`},this.ui_treeitem.update(),this.ui_treeitem}};return await e.LoadShots(),e}async function ie(){window.scenes=[],window.scenesDirHandle=await window.rootDirHandle.getDirectoryHandle("Scenes",{create:!0});for await(const[t,o]of window.scenesDirHandle.entries())if(o.kind==="directory"){let n=await ae(t,o);window.scenes.push(n)}}async function ce(){const t={split_shot_prompt:`
разбей эту сцену из моего сценария на шоты, сгенерируй промпты для нейросети для генерации видео и предоставь в виде json, в ответе предоставь толкьо json в следующем формате:
{
  "SHOT_010" : 
    {
    "prompt" : "подробный промпт для нейросети генератора видео", 
    "camera" : "focal length, shot type", 
    "action_description" : "описания действия которое происходит для аниматора", 
    },

}
    `,describe_prompt:`
  Опиши этого персонажа как промпт для генерации картинки.
  `,describe_env_prompt:`
  Опиши это окружение как промпт для генерации картинки.
  `,gpt_model:"gpt-4o-mini"};window.projinfo=await f(window.rootDirHandle,"projinfo.json",t)}async function w(){await ce(),await ie(),await window.treeViewContainer.reset(),await Ft()}function re(t){statusBar&&(statusBar.textContent=t),console.log(t)}window.updateStatus=re;window.rootDirHandle=null;window.treeViewContainer=document.getElementById("folders");window.contentsPanel=document.getElementById("contents");document.getElementById("status-bar");document.getElementById("pick").addEventListener("click",async()=>{try{window.rootDirHandle=await window.showDirectoryPicker({mode:"readwrite"}),await window.db.savePickedFolder(window.rootDirHandle),await w(),window.contentsPanel.innerHTML=""}catch(t){console.error("Folder pick canceled or failed",t)}});document.getElementById("add_scene_btn").addEventListener("click",async()=>{const t=prompt("SCENE NAME:","SC_0010");if(t){const o=await window.scenesDirHandle.getDirectoryHandle(t,{create:!0}),n=await LoadScene(t,o);window.treeViewContainer.addScene(n)}});document.getElementById("import_scenes_from_script_btn").addEventListener("click",async()=>{await importScenesFromScript()});window.addEventListener("DOMContentLoaded",async()=>{window.userdata=await window.db.loadUserData();const t=await window.db.loadPickedFolder();if(t){let o=await t.queryPermission({mode:"readwrite"});o!=="granted"&&(o=await t.requestPermission({mode:"readwrite"})),o==="granted"&&(window.rootDirHandle=t,await w())}});const vt=document.getElementById("recent-folders-menu");async function Ee(){const t=await window.db.loadRecentFolders();vt.innerHTML="",t.forEach((o,n)=>{const s=document.createElement("li");s.textContent=o.name,s.addEventListener("click",async()=>{let e=await o.queryPermission({mode:"readwrite"});e!=="granted"&&(e=await o.requestPermission({mode:"readwrite"})),e==="granted"&&(window.rootDirHandle=o,await w(),window.contentsPanel.innerHTML="")}),vt.appendChild(s)})}document.getElementById("open-recent").addEventListener("mouseenter",Ee);document.getElementById("settings_btn").addEventListener("click",async()=>{window.contentsPanel.innerHTML="";const t=document.createElement("div");await D(window.userdata,"KIE_API_KEY",t),await D(window.userdata,"GPT_API_KEY",t),await D(window.userdata,"openrouter_API_KEY",t);const o=N(t);T("log-proj-info-btn","LOG ProjInfo",o).addEventListener("click",async()=>{console.log("PROJECT INFO:",window.projinfo),console.log("USERDATA:",window.userdata)}),T("download-ahk-file","Download AHK",o,async()=>{const s=document.createElement("a");s.href="assets/MJ_SplitPaste.exe",s.download="MJ_SplitPaste.exe",document.body.appendChild(s),s.click(),document.body.removeChild(s)}),T("download-server-file","Download CMD_Server",o,async()=>{const s=document.createElement("a");s.href="assets/cmd_server.exe",s.download="cmd_server.exe",document.body.appendChild(s),s.click(),document.body.removeChild(s)}),await O(window.projinfo,"split_shot_prompt",t),await O(window.projinfo,"describe_prompt",t),await O(window.projinfo,"describe_env_prompt",t),Xt("GPT MODEL:",["gpt-4o-mini","gpt-5.1","gpt-5-mini","gpt-5-nano","gpt-5"],t,s=>{console.log("Picked model",s),window.projinfo.gpt_model=s,window.projinfo.save()}).setValue(window.projinfo.gpt_model),window.contentsPanel.appendChild(t)});document.getElementById("artbook_btn").addEventListener("click",async()=>{window.contentsPanel.innerHTML="",await R.createArtbookPanel(window.contentsPanel)});window.treeViewContainer.addScene=async function(t){const o=await t.getTreeItem();this.appendChild(o),xt(this)};window.treeViewContainer.reset=async function(){this.innerHTML="";for(const t of window.scenes)this.addScene(t)};
